var flowy=function(e,t,l,i,o,r,n,d){t||(t=function(){}),l||(l=function(){}),o||(o=function(){return!0}),r||(r=function(){return!1}),n||(n=20),d||(d=80);var c=!1;function a(e,t,l){return o(e,t,l)}function s(e,t){return r(e,t)}flowy.load=function(){if(!c){c=!0;var o,r,p,h,w,u,g=[],f=[],y=e,v=!1,C=n,m=d,k=0,_=0,x=!1,B=!1,b=!1,S=0,L=document.createElement("DIV");L.classList.add("indicator"),L.classList.add("invisible"),y.appendChild(L),flowy.import=function(e){y.innerHTML=e.html;for(var t=0;t<e.blockarr.length;t++){var l={childwidth:parseFloat(e.blockarr[t].childwidth),parent:parseFloat(e.blockarr[t].parent),id:parseFloat(e.blockarr[t].id),x:parseFloat(e.blockarr[t].x),y:parseFloat(e.blockarr[t].y),width:parseFloat(e.blockarr[t].width),height:parseFloat(e.blockarr[t].height)};g.push(l)}g.length>1&&I()},flowy.output=function(){var e={html:y.innerHTML,blockarr:g,blocks:[]};if(g.length>0){for(var t=0;t<g.length;t++){e.blocks.push({id:g[t].id,parent:g[t].parent,data:[],attr:[]});var l=document.querySelector(".blockid[value='"+g[t].id+"']").parentNode;l.querySelectorAll("input").forEach((function(l){var i=l.getAttribute("name");e.blocks[t].data.push({name:i,value:l.value})})),Array.prototype.slice.call(l.attributes).forEach((function(l){var i={};i[l.name]=l.value,e.blocks[t].attr.push(i)}))}return e}},flowy.deleteBlocks=function(){g=[],y.innerHTML="<div class='indicator invisible'></div>"},flowy.beginDrag=function(e){if(e.targetTouches?(w=e.changedTouches[0].clientX,u=e.changedTouches[0].clientY):(w=e.clientX,u=e.clientY),3!=e.which&&e.target.closest(".create-flowy")){h=e.target.closest(".create-flowy");var l=e.target.closest(".create-flowy").cloneNode(!0);e.target.closest(".create-flowy").classList.add("dragnow"),console.log(e.target.closest(".create-flowy")),l.classList.add("block"),l.classList.remove("create-flowy"),0===g.length?(l.innerHTML+="<input type='hidden' name='blockid' class='blockid' value='"+g.length+"'>",document.body.appendChild(l),o=document.querySelector(".blockid[value='"+g.length+"']").parentNode):(l.innerHTML+="<input type='hidden' name='blockid' class='blockid' value='"+(Math.max.apply(Math,g.map(e=>e.id))+1)+"'>",document.body.appendChild(l),o=document.querySelector(".blockid[value='"+(parseInt(Math.max.apply(Math,g.map(e=>e.id)))+1)+"']").parentNode),i=e.target.closest(".create-flowy"),t(i),o.classList.add("dragging"),v=!0,r=w-e.target.closest(".create-flowy").getBoundingClientRect().left,p=u-e.target.closest(".create-flowy").getBoundingClientRect().top,o.style.left=w-r+"px",o.style.top=u-p+"px",console.log("LEFT, TOP",o.style.left,o.style.top)}var i},document.addEventListener("mousedown",q,!1),document.addEventListener("touchstart",q,!1),document.addEventListener("mouseup",q,!1),flowy.touchDone=function(){b=!1},document.addEventListener("mousedown",flowy.beginDrag),document.addEventListener("touchstart",flowy.beginDrag),flowy.endDrag=function(e){if(3!=e.which&&(v||x))if(b=!1,l(),document.querySelector(".indicator").classList.contains("invisible")||document.querySelector(".indicator").classList.add("invisible"),v&&(h.classList.remove("dragnow"),o.classList.remove("dragging")),0===parseInt(o.querySelector(".blockid").value)&&x){o.classList.remove("dragging"),console.log("DRAGGING ROOT NODE"),x=!1;for(var t=0;t<f.length;t++)if(f[t].id!=parseInt(o.querySelector(".blockid").value)){const e=document.querySelector(".blockid[value='"+f[t].id+"']").parentNode,l=document.querySelector(".arrowid[value='"+f[t].id+"']").parentNode;e.style.left=e.getBoundingClientRect().left+window.scrollX-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft-1+"px",e.style.top=e.getBoundingClientRect().top+window.scrollY-(y.getBoundingClientRect().top+window.scrollY)+y.scrollTop-1+"px",l.style.left=l.getBoundingClientRect().left+window.scrollX-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft-1+"px",l.style.top=l.getBoundingClientRect().top+window.scrollY-(y.getBoundingClientRect().top+y.scrollTop)-1+"px",y.appendChild(e),y.appendChild(l),f[t].x=e.getBoundingClientRect().left+window.scrollX+parseInt(e.offsetWidth)/2+y.scrollLeft-1,f[t].y=e.getBoundingClientRect().top+window.scrollY+parseInt(e.offsetHeight)/2+y.scrollTop-1}allCustomArrows=document.querySelectorAll(".arrowid[value*='~']");for(var i=0;i<allCustomArrows.length;i++);f.filter(e=>0==e.id)[0].x=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2,f.filter(e=>0==e.id)[0].y=o.getBoundingClientRect().top+window.scrollY+parseInt(window.getComputedStyle(o).height)/2,g=g.concat(f),f=[]}else if(v&&0==g.length&&o.getBoundingClientRect().top+window.scrollY>y.getBoundingClientRect().top+window.scrollY&&o.getBoundingClientRect().left+window.scrollX>y.getBoundingClientRect().left+window.scrollX)a(o,!0,void 0),v=!1,o.style.top=o.getBoundingClientRect().top+window.scrollY-(y.getBoundingClientRect().top+window.scrollY)+y.scrollTop+"px",o.style.left=o.getBoundingClientRect().left+window.scrollX-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px",y.appendChild(o),g.push({parent:-1,childwidth:0,id:parseInt(o.querySelector(".blockid").value),x:o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2+y.scrollLeft,y:o.getBoundingClientRect().top+window.scrollY+parseInt(window.getComputedStyle(o).height)/2+y.scrollTop,width:parseInt(window.getComputedStyle(o).width),height:parseInt(window.getComputedStyle(o).height)});else if(v&&0==g.length)y.appendChild(document.querySelector(".indicator")),o.parentNode.removeChild(o);else if(v){var r=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2+y.scrollLeft,n=o.getBoundingClientRect().top+window.scrollY+y.scrollTop,d=g.map(e=>e.id);for(i=0;i<g.length;i++){if(r>=g.filter(e=>e.id==d[i])[0].x-g.filter(e=>e.id==d[i])[0].width/2-C&&r<=g.filter(e=>e.id==d[i])[0].x+g.filter(e=>e.id==d[i])[0].width/2+C&&n>=g.filter(e=>e.id==d[i])[0].y-g.filter(e=>e.id==d[i])[0].height/2&&n<=g.filter(e=>e.id==d[i])[0].y+g.filter(e=>e.id==d[i])[0].height){v=!1,a(o,!1,document.querySelector(".blockid[value='"+d[i]+"']").parentNode)?R(o,i,d):(v=!1,y.appendChild(document.querySelector(".indicator")),o.parentNode.removeChild(o));break}i==g.length-1&&(v=!1,y.appendChild(document.querySelector(".indicator")),o.parentNode.removeChild(o))}}else if(x)for(r=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2+y.scrollLeft,n=o.getBoundingClientRect().top+window.scrollY+y.scrollTop,d=g.map(e=>e.id),i=0;i<g.length;i++){if(r>=g.filter(e=>e.id==d[i])[0].x-g.filter(e=>e.id==d[i])[0].width/2-C&&r<=g.filter(e=>e.id==d[i])[0].x+g.filter(e=>e.id==d[i])[0].width/2+C&&n>=g.filter(e=>e.id==d[i])[0].y-g.filter(e=>e.id==d[i])[0].height/2&&n<=g.filter(e=>e.id==d[i])[0].y+g.filter(e=>e.id==d[i])[0].height){v=!1,o.classList.remove("dragging"),R(o,i,d);break}if(i==g.length-1){if(s(o,g.filter(e=>e.id==d[i])[0])){v=!1,o.classList.remove("dragging"),R(o,d.indexOf(S),d);break}x=!1,f=[],v=!1,y.appendChild(document.querySelector(".indicator")),o.parentNode.removeChild(o);break}}},document.addEventListener("mouseup",flowy.endDrag,!1),document.addEventListener("touchend",flowy.endDrag,!1),flowy.moveBlock=function(e){if(e.targetTouches?(w=e.targetTouches[0].clientX,u=e.targetTouches[0].clientY):(w=e.clientX,u=e.clientY),b){x=!0,o.classList.add("dragging");var t=parseInt(o.querySelector(".blockid").value);S=g.filter(e=>e.id==t)[0].parent,f.push(g.filter(e=>e.id==t)[0]),g=g.filter((function(e){return e.id!=t})),0!=t&&document.querySelector(".arrowid[value='"+t+"']").parentNode.remove();for(var l=g.filter(e=>e.parent==t),i=!1,n=[],d=[];!i;){for(var c=0;c<l.length;c++)if(l[c]!=t){f.push(g.filter(e=>e.id==l[c].id)[0]);const e=document.querySelector(".blockid[value='"+l[c].id+"']").parentNode,t=document.querySelector(".arrowid[value='"+l[c].id+"']").parentNode;e.style.left=e.getBoundingClientRect().left+window.scrollX-(o.getBoundingClientRect().left+window.scrollX)+"px",e.style.top=e.getBoundingClientRect().top+window.scrollY-(o.getBoundingClientRect().top+window.scrollY)+"px",t.style.left=t.getBoundingClientRect().left+window.scrollX-(o.getBoundingClientRect().left+window.scrollX)+"px",t.style.top=t.getBoundingClientRect().top+window.scrollY-(o.getBoundingClientRect().top+window.scrollY)+"px",o.appendChild(e),o.appendChild(t),n.push(l[c].id),d.push(l[c].id)}0==n.length?i=!0:(l=g.filter(e=>n.includes(e.parent)),n=[])}for(c=0;c<g.filter(e=>e.parent==t).length;c++){var a=g.filter(e=>e.parent==t)[c];g=g.filter((function(e){return e.id!=a}))}for(c=0;c<d.length;c++)a=d[c],g=g.filter((function(e){return e.id!=a}));g.length>1&&I(),B&&function(){if(_<y.getBoundingClientRect().left+window.scrollX){B=!1;for(var e=g.map(e=>e.id),t=0;t<g.length;t++)if(document.querySelector(".blockid[value='"+g.filter(l=>l.id==e[t])[0].id+"']").parentNode.style.left=g.filter(l=>l.id==e[t])[0].x-g.filter(l=>l.id==e[t])[0].width/2-_-20+"px",g.filter(l=>l.id==e[t])[0].x=document.querySelector(".blockid[value='"+g.filter(l=>l.id==e[t])[0].id+"']").parentNode.getBoundingClientRect().left+window.scrollX+g.filter(l=>l.id==e[t])[0].width/2,-1!=g.filter(l=>l.id==e[t])[0].parent){var l=g.filter(l=>l.id==e[t])[0],i=l.x-g.filter(l=>l.id==g.filter(l=>l.id==e[t])[0].parent)[0].x;document.querySelector('.arrowid[value="'+e[t]+'"]').parentNode.style.left=i<0?l.x-5-(y.getBoundingClientRect().left+window.scrollX)+"px":g.filter(l=>l.id==g.filter(l=>l.id==e[t])[0].parent)[0].x-20-(y.getBoundingClientRect().left+window.scrollX)+"px"}_=0}}(),b=!1}if(v?(o.style.left=w-r+"px",o.style.top=u-p+"px"):x&&(o.style.left=w-r-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px",o.style.top=u-p-(y.getBoundingClientRect().top+window.scrollY)+y.scrollTop+"px",f.filter(e=>e.id==parseInt(o.querySelector(".blockid").value)).x=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2+y.scrollLeft,f.filter(e=>e.id==parseInt(o.querySelector(".blockid").value)).y=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).height)/2+y.scrollTop,parseInt(o.style.left,10)<0&&(o.style.left="1px"),parseInt(o.style.top,10)<0&&(o.style.top="1px")),v||x){var s=o.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(o).width)/2+y.scrollLeft,h=o.getBoundingClientRect().top+window.scrollY+y.scrollTop,m=g.map(e=>e.id);for(c=0;c<g.length;c++){if(s>=g.filter(e=>e.id==m[c])[0].x-g.filter(e=>e.id==m[c])[0].width/2-C&&s<=g.filter(e=>e.id==m[c])[0].x+g.filter(e=>e.id==m[c])[0].width/2+C&&h>=g.filter(e=>e.id==m[c])[0].y-g.filter(e=>e.id==m[c])[0].height/2&&h<=g.filter(e=>e.id==m[c])[0].y+g.filter(e=>e.id==m[c])[0].height){document.querySelector(".blockid[value='"+m[c]+"']").parentNode.appendChild(document.querySelector(".indicator")),document.querySelector(".indicator").style.left=parseInt(window.getComputedStyle(document.querySelector(".blockid[value='"+m[c]+"']").parentNode).width)/2-5+"px",document.querySelector(".indicator").style.top=window.getComputedStyle(document.querySelector(".blockid[value='"+m[c]+"']").parentNode).height+"px",document.querySelector(".indicator").classList.remove("invisible");break}c==g.length-1&&(document.querySelector(".indicator").classList.contains("invisible")||document.querySelector(".indicator").classList.add("invisible"))}}},document.addEventListener("mousemove",flowy.moveBlock,!1),document.addEventListener("touchmove",flowy.moveBlock,!1)}function R(e,t,l){console.log(e,t,l,document.querySelector(".blockid[value='"+l[t]+"']").parentNode),parentBlock=document.querySelector(".blockid[value='"+l[t]+"']").parentNode,childBlock=e,x||y.appendChild(e);for(var i=0,o=0,r=0;r<g.filter(e=>e.parent==l[t]).length;r++)i+=(h=g.filter(e=>e.parent==l[t])[r]).childwidth>h.width?h.childwidth+C:h.width+C;for(i+=parseInt(window.getComputedStyle(e).width),r=0;r<g.filter(e=>e.parent==l[t]).length;r++)(h=g.filter(e=>e.parent==l[t])[r]).childwidth>h.width?(document.querySelector(".blockid[value='"+h.id+"']").parentNode.style.left=g.filter(e=>e.id==l[t])[0].x-i/2+o+h.childwidth/2-h.width/2+"px",h.x=g.filter(e=>e.parent==l[t])[0].x-i/2+o+h.childwidth/2,o+=h.childwidth+C):(document.querySelector(".blockid[value='"+h.id+"']").parentNode.style.left=g.filter(e=>e.id==l[t])[0].x-i/2+o+"px",h.x=g.filter(e=>e.parent==l[t])[0].x-i/2+o+h.width/2,o+=h.width+C);if(e.style.left=g.filter(e=>e.id==l[t])[0].x-i/2+o-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px",e.style.top=g.filter(e=>e.id==l[t])[0].y+g.filter(e=>e.id==l[t])[0].height/2+m-(y.getBoundingClientRect().top+window.scrollY)+"px",x){for(f.filter(t=>t.id==parseInt(e.querySelector(".blockid").value))[0].x=e.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(e).width)/2+y.scrollLeft,f.filter(t=>t.id==parseInt(e.querySelector(".blockid").value))[0].y=e.getBoundingClientRect().top+window.scrollY+parseInt(window.getComputedStyle(e).height)/2+y.scrollTop,f.filter(t=>t.id==e.querySelector(".blockid").value)[0].parent=l[t],r=0;r<f.length;r++)if(f[r].id!=parseInt(e.querySelector(".blockid").value)){const e=document.querySelector(".blockid[value='"+f[r].id+"']").parentNode,t=document.querySelector(".arrowid[value='"+f[r].id+"']").parentNode;e.style.left=e.getBoundingClientRect().left+window.scrollX-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px",e.style.top=e.getBoundingClientRect().top+window.scrollY-(y.getBoundingClientRect().top+window.scrollY)+y.scrollTop+"px",t.style.left=t.getBoundingClientRect().left+window.scrollX-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+20+"px",t.style.top=t.getBoundingClientRect().top+window.scrollY-(y.getBoundingClientRect().top+window.scrollY)+y.scrollTop+"px",y.appendChild(e),y.appendChild(t),f[r].x=e.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(e).width)/2+y.scrollLeft,f[r].y=e.getBoundingClientRect().top+window.scrollY+parseInt(window.getComputedStyle(e).height)/2+y.scrollTop}g=g.concat(f),f=[]}else g.push({childwidth:0,parent:l[t],id:parseInt(e.querySelector(".blockid").value),x:e.getBoundingClientRect().left+window.scrollX+parseInt(window.getComputedStyle(e).width)/2+y.scrollLeft,y:e.getBoundingClientRect().top+window.scrollY+parseInt(window.getComputedStyle(e).height)/2+y.scrollTop,width:parseInt(window.getComputedStyle(e).width),height:parseInt(window.getComputedStyle(e).height)});var n=g.filter(t=>t.id==parseInt(e.querySelector(".blockid").value))[0],d=n.x-g.filter(e=>e.id==l[t])[0].x+20,c=parseFloat(n.y-n.height/2-(g.filter(e=>e.parent==l[t])[0].y+g.filter(e=>e.parent==l[t])[0].height/2)+y.scrollTop);if(d<0?(y.innerHTML+='<div data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" class="arrowblock"><input type="hidden" class="arrowid" value="'+e.querySelector(".blockid").value+'"><svg data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+parentBlock.id+"~"+childBlock.id+'"  onclick = "arrowClick('+parentBlock.id+","+childBlock.id+');" data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M'+(g.filter(e=>e.id==l[t])[0].x-n.x+5)+" 0L"+(g.filter(e=>e.id==l[t])[0].x-n.x+5)+" "+m/2+"L5 "+m/2+"L5 "+c+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/><path d="M0 '+(c-5)+"H10L5 "+c+"L0 "+(c-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg></div>',document.querySelector('.arrowid[value="'+e.querySelector(".blockid").value+'"]').parentNode.style.left=n.x-5-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px"):(y.innerHTML+='<div data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" class="arrowblock"><input type="hidden" class="arrowid" value="'+e.querySelector(".blockid").value+'"><svg data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+parentBlock.id+"~"+childBlock.id+'"  onclick = "arrowClick('+parentBlock.id+","+childBlock.id+');" data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M20 0L20 '+m/2+"L"+d+" "+m/2+"L"+d+" "+c+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/><path data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M'+(d-5)+" "+(c-5)+"H"+(d+5)+"L"+d+" "+c+"L"+(d-5)+" "+(c-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg></div>',document.querySelector('.arrowid[value="'+parseInt(e.querySelector(".blockid").value)+'"]').parentNode.style.left=g.filter(e=>e.id==l[t])[0].x-20-(y.getBoundingClientRect().left+window.scrollX)+y.scrollLeft+"px"),document.querySelector('.arrowid[value="'+parseInt(e.querySelector(".blockid").value)+'"]').parentNode.style.top=g.filter(e=>e.id==l[t])[0].y+g.filter(e=>e.id==l[t])[0].height/2+"px",-1!=g.filter(e=>e.id==l[t])[0].parent){for(var a=!1,s=l[t];!a;)if(-1==g.filter(e=>e.id==s)[0].parent)a=!0;else{var p=0;for(r=0;r<g.filter(e=>e.parent==s).length;r++){var h;(h=g.filter(e=>e.parent==s)[r]).childwidth>h.width?r==g.filter(e=>e.parent==s).length-1?p+=h.childwidth:p+=h.childwidth+C:r==g.filter(e=>e.parent==s).length-1?p+=h.width:p+=h.width+C}g.filter(e=>e.id==s)[0].childwidth=p,s=g.filter(e=>e.id==s)[0].parent}g.filter(e=>e.id==s)[0].childwidth=i}x&&(x=!1,e.classList.remove("dragging")),I(),function(){k=g.map(e=>e.x);var e=g.map(e=>e.width),t=k.map((function(t,l){return t-e[l]/2}));if((k=Math.min.apply(Math,t))<y.getBoundingClientRect().left+window.scrollX){B=!0;for(var l=g.map(e=>e.id),i=0;i<g.length;i++)if(document.querySelector(".blockid[value='"+g.filter(e=>e.id==l[i])[0].id+"']").parentNode.style.left=g.filter(e=>e.id==l[i])[0].x-g.filter(e=>e.id==l[i])[0].width/2-k+20+"px",-1!=g.filter(e=>e.id==l[i])[0].parent){var o=g.filter(e=>e.id==l[i])[0],r=o.x-g.filter(e=>e.id==g.filter(e=>e.id==l[i])[0].parent)[0].x;document.querySelector('.arrowid[value="'+l[i]+'"]').parentNode.style.left=r<0?o.x-k+20-5+"px":g.filter(e=>e.id==g.filter(e=>e.id==l[i])[0].parent)[0].x-20-k+20+"px"}for(i=0;i<g.length;i++)g[i].x=document.querySelector(".blockid[value='"+g[i].id+"']").parentNode.getBoundingClientRect().left+window.scrollX+(y.getBoundingClientRect().left+y.scrollLeft)-parseInt(window.getComputedStyle(document.querySelector(".blockid[value='"+g[i].id+"']").parentNode).width)/2-40;_=k}}()}function q(e){if(element=e.target,"tool_footer"==element.className&&(console.log("Click on footer ARROW"),this.blockArrowParent=element,this.creatingArrowBegin=1),"tool_header"==element.className&&1==this.creatingArrowBegin&&(this.blockArrowChild=element,this.creatingArrowBegin=0,console.log("CREATING ARROW"),console.log(this.blockArrowParent,this.blockArrowChild),function(e,t,l){if(console.log(e,0,l),child_id=e.querySelector(".blockid").value,parent_id=l.querySelector(".blockid").value,console.log(g),start_point_y=parseInt(l.style.top)+g.filter(e=>e.id==parent_id)[0].height/2,start_point_x=parseInt(l.style.left)+g.filter(e=>e.id==parent_id)[0].width/2,end_point_y=parseInt(e.style.top)+g.filter(e=>e.id==child_id)[0].height/2,end_point_x=parseInt(e.style.left)+g.filter(e=>e.id==child_id)[0].width/2,end_point_y<=start_point_y){rel_endpoint_y=end_point_y-start_point_y,rel_endpoint_x=end_point_x-start_point_x,parent_height=g.filter(e=>e.id==parent_id)[0].height,child_height=g.filter(e=>e.id==child_id)[0].height;var i=rel_endpoint_y-child_height/2;newArrow='<div data-parent = "'+l.id+'" data-child = "'+e.id+'"                 class="arrowblock"><input type="hidden" class="arrowid" value="'+parent_id+"~"+child_id+'">                 <svg data-parent = "'+l.id+'" data-child = "'+e.id+'" preserveaspectratio="none" fill="none"                 xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+l.id+"~"+e.id+'"                  onclick = "arrowClick('+l.id+","+e.id+');" data-parent = "'+l.id+'"                 data-child = "'+e.id+'" d="M 0 0 L 0 '+(parent_height/2+40)+"L "+Math.sign(rel_endpoint_x)*(Math.abs(rel_endpoint_x/2)-20)+" "+(parent_height/2+40)+" L "+Math.sign(rel_endpoint_x)*(Math.abs(rel_endpoint_x/2)+20)+" "+(rel_endpoint_y-child_height/2-40)+" L "+rel_endpoint_x+" "+(rel_endpoint_y-child_height/2-40)+" L "+rel_endpoint_x+" "+rel_endpoint_y+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/>  <path d="M '+(rel_endpoint_x-5)+" "+(i-5)+" H "+(rel_endpoint_x+5)+" L "+rel_endpoint_x+" "+i+"L "+(rel_endpoint_x-5)+" "+(i-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg></div>'}else rel_endpoint_y=end_point_y-start_point_y,rel_endpoint_x=end_point_x-start_point_x,parent_height=g.filter(e=>e.id==parent_id)[0].height,child_height=g.filter(e=>e.id==child_id)[0].height,i=rel_endpoint_y-child_height/2,newArrow='<div data-parent = "'+l.id+'" data-child = "'+e.id+'"                 class="arrowblock"><input type="hidden" class="arrowid" value="'+parent_id+"~"+child_id+'">                 <svg data-parent = "'+l.id+'" data-child = "'+e.id+'" preserveaspectratio="none" fill="none"                 xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+l.id+"~"+e.id+'"                  onclick = "arrowClick('+l.id+","+e.id+');" data-parent = "'+l.id+'"                 data-child = "'+e.id+'" d="M 0 0 L 0 '+(rel_endpoint_y-child_height/2-40)+"L "+rel_endpoint_x+" "+(rel_endpoint_y-child_height/2-40)+" L "+rel_endpoint_x+" "+rel_endpoint_y+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/>  <path d="M '+(rel_endpoint_x-5)+" "+(i-5)+" H "+(rel_endpoint_x+5)+" L "+rel_endpoint_x+" "+i+"L "+(rel_endpoint_x-5)+" "+(i-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg></div>';y.innerHTML=newArrow+y.innerHTML,document.querySelector('.arrowid[value="'+parent_id+"~"+child_id+'"]').parentNode.style.top=parseInt(l.style.top)+g.filter(e=>e.id==parent_id)[0].height/2+"px",document.querySelector('.arrowid[value="'+parent_id+"~"+child_id+'"]').parentNode.style.left=parseInt(l.style.left)+g.filter(e=>e.id==parent_id)[0].width/2+"px"}(this.blockArrowChild.parentElement,0,this.blockArrowParent.parentElement)),b=!1,N(e.target,"block")){var t=e.target.closest(".block");e.targetTouches?(w=e.targetTouches[0].clientX,u=e.targetTouches[0].clientY):(w=e.clientX,u=e.clientY),"mouseup"!==e.type&&N(e.target,"block")&&3!=e.which&&(v||x||(b=!0,r=w-((o=t).getBoundingClientRect().left+window.scrollX),p=u-(o.getBoundingClientRect().top+window.scrollY)))}}function N(e,t){if(e.className&&"arrow_svg"==e.className.baseVal){var l=(e=e.parentNode.parentNode).getAttribute("data-child"),o=e.getAttribute("data-parent");console.log(l,o),r=l,n=o,console.log("clicked on arrow",r,n),i(r,n)}var r,n;return e.className.split(" ").indexOf(t)>=0||e.parentNode&&N(e.parentNode,t)}function I(){for(var e=g.map(e=>e.parent),t=0;t<e.length;t++){-1==e[t]&&t++;for(var l=0,i=0,o=0;o<g.filter(l=>l.parent==e[t]).length;o++){var r=g.filter(l=>l.parent==e[t])[o];0==g.filter(e=>e.parent==r.id).length&&(r.childwidth=0),r.childwidth>r.width?o==g.filter(l=>l.parent==e[t]).length-1?l+=r.childwidth:l+=r.childwidth+C:o==g.filter(l=>l.parent==e[t]).length-1?l+=r.width:l+=r.width+C}for(-1!=e[t]&&(g.filter(l=>l.id==e[t])[0].childwidth=l),o=0;o<g.filter(l=>l.parent==e[t]).length;o++){r=g.filter(l=>l.parent==e[t])[o];const a=document.querySelector(".blockid[value='"+r.id+"']").parentNode,s=g.filter(l=>l.id==e[t]);a.style.top=s.y+m+"px",s.y=s.y+m,r.childwidth>r.width?(a.style.left=s[0].x-l/2+i+r.childwidth/2-r.width/2-(y.getBoundingClientRect().left+window.scrollX)+"px",r.x=s[0].x-l/2+i+r.childwidth/2,i+=r.childwidth+C):(a.style.left=s[0].x-l/2+i-(y.getBoundingClientRect().left+window.scrollX)+"px",r.x=s[0].x-l/2+i+r.width/2,i+=r.width+C);var n=g.filter(e=>e.id==r.id)[0],d=n.x-g.filter(e=>e.id==r.parent)[0].x+20,c=n.y-n.height/2-(g.filter(e=>e.id==r.parent)[0].y+g.filter(e=>e.id==r.parent)[0].height/2);document.querySelector('.arrowid[value="'+r.id+'"]').parentNode.style.top=g.filter(e=>e.id==r.parent)[0].y+g.filter(e=>e.id==r.parent)[0].height/2-(y.getBoundingClientRect().top+window.scrollY)+"px",d<0?(document.querySelector('.arrowid[value="'+r.id+'"]').parentNode.style.left=n.x-5-(y.getBoundingClientRect().left+window.scrollX)+"px",document.querySelector('.arrowid[value="'+r.id+'"]').parentNode.innerHTML='<input type="hidden" class="arrowid" value="'+r.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+parentBlock.id+"~"+childBlock.id+'"  onclick = "arrowClick('+parentBlock.id+","+childBlock.id+');" data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M'+(g.filter(e=>e.id==r.parent)[0].x-n.x+5)+" 0L"+(g.filter(e=>e.id==r.parent)[0].x-n.x+5)+" "+m/2+"L5 "+m/2+"L5 "+c+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/><path data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M0 '+(c-5)+"H10L5 "+c+"L0 "+(c-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg>'):(document.querySelector('.arrowid[value="'+r.id+'"]').parentNode.style.left=g.filter(e=>e.id==r.parent)[0].x+50-20-(y.getBoundingClientRect().left+window.scrollX)+"px",document.querySelector('.arrowid[value="'+r.id+'"]').parentNode.innerHTML='<input type="hidden" class="arrowid" value="'+r.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path id = "arrow_'+parentBlock.id+"~"+childBlock.id+'"  onclick = "arrowClick('+parentBlock.id+","+childBlock.id+');" data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M-30 0L-30 '+m/2+"L"+(d-50)+" "+m/2+"L"+(d-50)+" "+c+'" class="arrow_svg" stroke="#C5CCD0" stroke-width="2px"/><path data-parent = "'+parentBlock.id+'" data-child = "'+childBlock.id+'" d="M'+(d-5-50)+" "+(c-5)+"H"+(d+5-50)+"L"+(d-50)+" "+c+"L"+(d-5-50)+" "+(c-5)+'Z" class="arrow_pointer_svg" fill="#C5CCD0"/></svg>')}}}},flowy.load()};